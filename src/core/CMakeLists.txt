# ğŸ“ src/core/CMakeLists.txt
# æ ¸å¿ƒåº“å®šä¹‰
add_library(north_core STATIC
    io/io.c
    lexer/lexer.c
    lexer/nonterminal.c
    lexer/symbol.c
    lexer/token.c
    pool/pool.c
)

# åŒ…å«ç›®å½•é…ç½®
target_include_directories(north_core PUBLIC
    $<BUILD_INTERFACE:${CMAKE_CURRENT_SOURCE_DIR}/../../include/core>
    $<INSTALL_INTERFACE:include>
    ${LLVM_INCLUDE_DIRS}
)

# ç¼–è¯‘å™¨é€‰é¡¹
set_target_compile_options(north_core)

# ä¾èµ–é…ç½®
target_link_libraries(north_core PUBLIC
    ${LLVM_LIBS}
    LibEdit::LibEdit
    CURL::libcurl
    atomic pthread curses tinfo xml2 ffi
)

# Sanitizeré…ç½®ï¼ˆä»…Debugæ¨¡å¼ï¼‰
if(CMAKE_C_COMPILER_ID MATCHES "Clang|GNU")
    target_link_options(north_core PRIVATE
        $<$<CONFIG:Debug>:-fsanitize=address,undefined>
        $<$<CONFIG:Debug>:-fno-omit-frame-pointer>
    )
    
    target_link_libraries(north_core PUBLIC
        $<$<CONFIG:Debug>:-lasan -lubsan>
        ${CMAKE_DL_LIBS} 
    )
endif()

# å•å…ƒæµ‹è¯•å®å®šä¹‰
target_compile_definitions(north_core PRIVATE
    $<$<BOOL:${UNIT_TESTING}>:UNIT_TESTING=1>
)



